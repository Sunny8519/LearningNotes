## App优化之卡顿

### 1. 16ms原则

Android 系统会每隔16ms发出VSYNC信号重绘界面。为什么是16ms呢，因为Android设定的刷新频率是60FPS(Frame Per Second)，也就是每秒60帧的频率，约合16ms刷新一次。

造成页面卡顿的原因就是我们无法在16ms内完成下次界面刷新所需要的数据，这样用户就需要再等16ms甚至更长的时间才能见到改变后的界面，这样给用户的感觉就是丢帧了。、

### 2. 卡顿原因

#### 2.1 复杂的布局

界面性能取决于UI渲染的性能，UI渲染的整个过程我们可以理解为由CPU和GPU两部分协作完成的，CPU负责UI元素的Measure，Layout，Draw，而GPU简单来说就是负责把Measure，Layout，Draw得到的UI数据绘制到屏幕上，如果我们的UI布局层次太深，可能导致CPU在Measure，Layout，Draw上花去的时间大于16ms，导致卡顿。

这种问题我们可以使用HierarchyViewer工具来检测并定位问题。

#### 2.2 过度绘制

前面复杂的布局中说的是CPU的Measure，Layout，Draw，这里要说的是GPU的绘制，如果GPU存在过度绘制的问题，也会导致卡顿。什么是过度绘制？在理想情况下，屏幕每一帧上的每个像素点应该只会被绘制一次，如果存在多次绘制的情况就是过度绘制了。

##### 2.2.1 检测过度绘制

Android系统的移动设备上一般都会提供有“调试GPU过度绘制”的功能，在开发者模式下就能找到。我们开启这个功能后会发现界面上会出现蓝色，绿色，粉色，红色等区块，这些颜色分别表示的意思如下：

- 蓝色：1次绘制
- 绿色：2次绘制
- 粉色：3次绘制
- 红色：4次及4次以上绘制
- 原色：没有绘制(这个不是太理解)